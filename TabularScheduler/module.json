{
  "singleton": false,
  "dependencies": [
    "Cron",
    "Presence",
    "BaseModule",
    "Astronomy"
  ],
  "category": "automation_basic",
  "author": "John Talintyre",
  "homepage": "https://github.com/jet11x/Zway/tree/master/TabularScheduler",
  "icon": "icon.png",
  "moduleName": "TabularScheduler",
  "version": "0.0.5",
  "maturity": "beta",
  "defaults": {
    "title": "__m_title__",
    "description": "__m_descr__",
    "timetable": [
      {
        "presence": "any",
        "days": "All",
        "startTime": "15:00",
        "endTime": "22:00"
      }
    ],
    "helpText": "__help_title__",
    "activeHours": {
      "set": true,
      "startType": "sunsetMinus",
      "startTime": "00:10",
      "endType": "sunrisePlus",
      "endTime": "00:10"
    },
    "startRand": {
      "maxAdj": "00:10"
    },
    "endRand": {
      "maxAdj": "00:10"
    },
    "sensorTrigger": {
      "timeout": "00:00:05"
    },
    "logging": "summary"
  },
  "schema": {
    "type": "object",
    "properties": {
      "timetable": {
        "title": "__table_title__",
        "type": "array",
        "minItems": 1,
        "items": {
          "type": "object",
          "properties": {
            "presence": {
              "type": "string",
              "title": "__table_presence_title__",
              "enum": [
                "any",
                "home",
                "away",
                "vacation"
              ]
            },
            "randomise": {
              "title": "__table_random_title__",
              "type": "string",
              "enum": [
                "yes",
                "no"
              ]
            },
            "days": {
              "title": "__table_days_title__",
              "type": "string",
              "enum": [
                "All",
                "Weekends",
                "Weekdays"
              ],
              "default": "All"
            },
            "startTime": {
              "type": "string",
              "title": "__table_start_time_title__",
              "pattern": "^([01][0-9]|2[0-3]):[0-5][0-9]$",
              "default": "00:00"
            },
            "endTime": {
              "type": "string",
              "title": "__table_end_time_title__",
              "pattern": "^([01][0-9]|2[0-3]):[0-5][0-9]$",
              "default": "00:00"
            },
            "config": {
              "type": "string",
              "title": "__table_config_title__"
            }
          }
        }
      },
      "showHelp": {
        "type": "string",
        "enum": [
          "Showing help"
        ]
      },
      "helpText": {
        "type": "string",
        "readonly": true,
        "dependencies": [
          "showHelp"
        ]
      },
      "activeHours": {
        "type": "object",
        "properties": {
          "set": {
            "type": "boolean"
          },
          "startType": {
            "type": "string",
            "title": "__active_start_type_title__",
            "enum": [
              "sunset",
              "sunsetPlus",
              "sunsetMinus",
              "time"
            ],
            "dependencies": ["set"]
          },
          "startTime": {
            "type": "string",
            "title": "__active_start_time__",
            "dependencies": ["startType"]
          },
          "endType": {
            "type": "string",
            "title": "__active_end_type_title__",
            "enum": [
              "sunrise",
              "sunrisePlus",
              "sunriseMinus",
              "time"
            ],
            "dependencies": ["set"]
          },
          "endTime": {
            "type": "string",
            "title": "__active_end_time__",
            "dependencies": ["endType"]
          },
          "config": {
            "type": "string",
            "title": "__active_config_title__",
            "dependencies": ["set"]
          }
        }
      },
      "sensorTrigger": {
        "type": "object",
        "properties": {
          "set": {
            "type": "boolean"
          },
          "sensors": {
            "items": {
              "datasource": "namespaces",
              "enum": "namespaces:devices_sensorBinary:deviceId,namespaces:devices_switchBinary:deviceId",
              "field": "enum"
            },
            "type": "array",
            "uniqueItems": true,
            "dependencies": [
              "set"
            ]
          },
          "timeout" : {
            "title": "__timeout_title__",
            "type" : "string",
            "dependencies": [
              "set"
            ]
          },
          "config": {
            "type": "string",
            "title": "__sensors_config_title__"
          }
        }
      },
      "startRand": {
        "type": "object",
        "properties": {
          "randType": {
            "type": "string",
            "title": "Randomly Move Start Time (change to just minutes!!!) - affects table entries where Random column is Yes",
            "enum": [
              "evenUp",
              "evenDown",
              "evenUpDown"
            ]
          },
          "maxAdj": {
            "type": "string",
            "pattern": "^(0[0-9]:[0-5][0-9]$"
          }
        },
        "dependencies": {
          "maxAdj": [
            "randType"
          ]
        }
      },
      "endRand": {
        "type": "object",
        "properties": {
          "randType": {
            "type": "string",
            "title": "Randomly Move End Time - affects table entries where Random column is Yes",
            "enum": [
              "evenUp",
              "evenDown",
              "evenUpDown"
            ]
          },
          "maxAdj": {
            "type": "string",
            "pattern": "^(0[0-9]:[0-5][0-9]$"
          }
        },
        "dependencies": {
          "maxAdj": [
            "randType"
          ]
        }
      },
      "switches": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "filter": {
              "type": "string",
              "enum": [
                "switchBinary",
                "switchMultilevel"
              ],
              "required": true
            },
            "switchBinary": {
              "type": "object",
              "dependencies": "filter",
              "properties": {
                "device": {
                  "type": "string",
                  "field": "enum",
                  "datasource": "namespaces",
                  "enum": "namespaces:devices_switchBinary:deviceId",
                  "required": true
                },
                "ref": {
                  "type": "string"
                }
              }
            },
            "switchMultilevel": {
              "type": "object",
              "dependencies": "filter",
              "properties": {
                "device": {
                  "datasource": "namespaces",
                  "enum": "namespaces:devices_switchMultilevel:deviceId,namespaces:devices_switchRGBW:deviceId",
                  "field": "enum",
                  "required": true,
                  "type": "string"
                },
                "startLevel": {
                  "maximum": "99",
                  "minimum": "0",
                  "required": true,
                  "type": "integer"
                },
                "endLevel": {
                  "maximum": "99",
                  "minimum": "0",
                  "required": true,
                  "type": "integer"
                },
                "ref": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "logging": {
        "title": "What should be logged in z-way-server.log (usual location is /var/log)?",
        "type": "string",
        "title": "Logging Level",
        "enum": [
          "summary",
          "detailed",
          "veryDetailed"
        ]
      }
    }
  },
  "options": {
    "fields": {
      "timetable": {
        "type": "table",
        "items": {
          "fields": {
            "presence": {
              "type": "select",
              "sort": false,
              "optionLabels": [
                "Any",
                "Home",
                "Away",
                "Vacation"
              ]
            },
            "randomise": {
              "type": "select",
              "removeDefaultNone": true,
              "optionLabels": [
                "Yes",
                "No"
              ]
            },
            "days": {
              "type": "select",
              "removeDefaultNone": true
            },
            "startTime": {
              "maskString": "99:99",
              "size": 4
            },
            "endTime": {
              "type": "text",
              "maskString": "99:99",
              "size": 4
            },
            "config": {
              "type": "text",
              "size": 8
            }
          }
        }
      },
      "showHelp": {
        "type": "select",
        "noneLabel": "Not showing help"
      },
      "helpText": {
        "type": "text",
        "helpers": [
          "__help_presence__",
          "__help_random__",
          "__help_days__",
          "__help_start_type__",
          "__help_start_time__",
          "__help_end_type__",
          "__help_end_time__",
          "__help_config__",
          "__help_config_examples__"
        ]
      },
      "activeHours": {
        "fields": {
          "set": {
            "type": "checkbox",
            "rightLabel": "__active_hours_title__"
          },
          "startType": {
            "type": "select",
            "optionLabels": [
              "Sunset",
              "Sunset+Time",
              "Sunset-Time",
              "Time"
            ],
            "removeDefaultNone": true,
            "sort": false,
            "dependencies": {
              "set": true
            }
          },
          "startTime": {
            "type": "time",
            "dateFormat": "HH:mm",
            "dependencies": {
              "startType": ["sunsetPlus", "sunsetMinus", "time"]
            }
          },
          "endType": {
            "type": "select",
            "optionLabels": [
              "Sunrise",
              "Sunrise+Time",
              "Sunrise-Time",
              "Time"
            ],
            "removeDefaultNone": true,
            "sort": false,
            "dependencies": {
              "set": true
            }
          },
          "endTime": {
            "type": "time",
            "dateFormat": "HH:mm",
            "dependencies": {
              "endType": ["sunrisePlus", "sunriseMinus", "time"]
            }
          },
          "config": {
            "type": "text",
            "size": 20,
            "dependencies": {
              "set": true
            }
          }
        }
      },
      "sensorTrigger": {
        "fields": {
          "set": {
            "type": "checkbox",
            "rightLabel": "Sensors can trigger lights"
          },
          "sensors" : {
            "fields": {
              "item": {
                "datasource": "namespaces",
                "field": "devices",
                "optionLabels": "namespaces:devices_sensorBinary:deviceName,namespaces:devices_switchBinary:deviceName",
                "type": "select"
              }
            },
            "label": "__sensors_label__"
          },
          "timeout" : {
            "type": "time",
            "dateFormat": "HH:mm:ss",
            "helper": "__sensor_timeout__"
          },
          "config": {
            "type": "text",
            "size": 20
          }
        }
      },
      "startRand": {
        "fields": {
          "randType": {
            "type": "select",
            "optionLabels": [
              "Even Up (increase time by evenly spread random number of hours/mins up to specified max HH:mm)",
              "Even Down (decrease time by evenly spread random number of hours/mins up to specified max HH:mm)",
              "Even Up & Down (increase/decrease time by evenly spread random number between -HH:mm/2 and +HH:mm/2"
            ]
          },
          "maxAdj": {
            "type": "time",
            "dateFormat": "HH:mm",
            "helper": "__rand_maxAdj__"
          }
        }
      },
      "endRand": {
        "fields": {
          "randType": {
            "type": "select",
            "optionLabels": [
              "Even Up (increase time by evenly spread random number of hours/mins up to specified max HH:mm)",
              "Even Down (decrease time by evenly spread random number of hours/mins up to specified max HH:mm)",
              "Even Up & Down (increase/decrease time by evenly spread random number between -HH:mm/2 and +HH:mm/2"
            ]
          },
          "maxAdj": {
            "helper": "__rand_maxAdj__"
          }
        }
      },
      "switches": {
        "label": "__l_switches__",
        "items": {
          "fields": {
            "filter": {
              "type": "select",
              "removeDefaultNone": false,
              "noneLabel": "__l_choose_type__",
              "label": "__l_filter__",
              "optionLabels": [
                "__switchBinary__",
                "__switchMultilevel__"
              ]
            },
            "switchBinary": {
              "dependencies": {
                "filter": "switchBinary"
              },
              "fields": {
                "device": {
                  "type": "select",
                  "removeDefaultNone": false,
                  "noneLabel": "__l_choose_dev__",
                  "datasource": "namespaces",
                  "field": "optionLabels",
                  "optionLabels": "namespaces:devices_switchBinary:deviceName"
                },
                "ref": {
                  "type": "text",
                  "helper": "Optional reference that can be used in <b>Config</b> column of table of schedule entries"
                }
              }
            },
            "switchMultilevel": {
              "dependencies": {
                "filter": "switchMultilevel"
              },
              "fields": {
                "device": {
                  "datasource": "namespaces",
                  "field": "optionLabels",
                  "noneLabel": "__l_choose_dev__",
                  "optionLabels": "namespaces:devices_switchMultilevel:deviceName,namespaces:devices_switchRGBW:deviceName",
                  "removeDefaultNone": false,
                  "type": "select"
                },
                "startLevel": {
                  "type": "integer",
                  "helper": "Level to set to at start"
                },
                "endLevel": {
                  "type": "integer",
                  "helper": "Level to set to at end"
                },
                "ref": {
                  "type": "text",
                  "helper": "Optional reference that can be used in <b>Config</b> column of table of schedule entries"
                }
              }
            }
          }
        }
      },
      "logging": {
        "type": "select",
        "noneLabel": "Nothing",
        "sort": false,
        "optionLabels": [
          "1 Summary",
          "2 Detailed",
          "3 Very Detailed"
        ]
      }
    }
  }
}